# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/cost_tracking.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.CostTrackingTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: COST-001
  @tag :cost
  @tag :unit
  test "[COST-001] 记录单次 LLM 调用" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "COST-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: WHEN init_cost_tracker
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :init_cost_tracker, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 10, raw: "WHEN init_cost_tracker"}, 10)
    # line 11: WHEN record_llm_call model="deepseek-chat" input_tokens=100 output_tokens=50
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :record_llm_call, %{input_tokens: 100, model: "deepseek-chat", output_tokens: 50}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 11, raw: "WHEN record_llm_call model=\"deepseek-chat\" input_tokens=100 output_tokens=50"}, 11)
    # line 12: THEN assert_cost_summary call_count=1
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_cost_summary, %{call_count: 1}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 12, raw: "THEN assert_cost_summary call_count=1"}, 12)
    _ctx = ctx
    :ok
  end

  # Source: COST-002
  @tag :cost
  @tag :unit
  test "[COST-002] 累计多次调用统计" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "COST-002"}
    # line 15: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 15, raw: "GIVEN create_temp_dir"}, 15)
    # line 16: WHEN init_cost_tracker
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :init_cost_tracker, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 16, raw: "WHEN init_cost_tracker"}, 16)
    # line 17: WHEN record_llm_call model="deepseek-chat" input_tokens=100 output_tokens=50
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :record_llm_call, %{input_tokens: 100, model: "deepseek-chat", output_tokens: 50}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 17, raw: "WHEN record_llm_call model=\"deepseek-chat\" input_tokens=100 output_tokens=50"}, 17)
    # line 18: WHEN record_llm_call model="deepseek-chat" input_tokens=200 output_tokens=100
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :record_llm_call, %{input_tokens: 200, model: "deepseek-chat", output_tokens: 100}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 18, raw: "WHEN record_llm_call model=\"deepseek-chat\" input_tokens=200 output_tokens=100"}, 18)
    # line 19: THEN assert_cost_summary call_count=2 total_input=300 total_output=150
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_cost_summary, %{call_count: 2, total_input: 300, total_output: 150}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 19, raw: "THEN assert_cost_summary call_count=2 total_input=300 total_output=150"}, 19)
    _ctx = ctx
    :ok
  end

  # Source: COST-003
  @tag :cost
  @tag :unit
  test "[COST-003] 最近一次调用记录" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "COST-003"}
    # line 22: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 22, raw: "GIVEN create_temp_dir"}, 22)
    # line 23: WHEN init_cost_tracker
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :init_cost_tracker, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 23, raw: "WHEN init_cost_tracker"}, 23)
    # line 24: WHEN record_llm_call model="gpt-4" input_tokens=500 output_tokens=200
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :record_llm_call, %{input_tokens: 500, model: "gpt-4", output_tokens: 200}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 24, raw: "WHEN record_llm_call model=\"gpt-4\" input_tokens=500 output_tokens=200"}, 24)
    # line 25: THEN assert_last_call model="gpt-4"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_last_call, %{model: "gpt-4"}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 25, raw: "THEN assert_last_call model=\"gpt-4\""}, 25)
    _ctx = ctx
    :ok
  end

  # Source: COST-004
  @tag :cost
  @tag :unit
  test "[COST-004] 重置后清空历史" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "COST-004"}
    # line 28: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 28, raw: "GIVEN create_temp_dir"}, 28)
    # line 29: WHEN init_cost_tracker
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :init_cost_tracker, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 29, raw: "WHEN init_cost_tracker"}, 29)
    # line 30: WHEN record_llm_call model="deepseek-chat" input_tokens=100 output_tokens=50
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :record_llm_call, %{input_tokens: 100, model: "deepseek-chat", output_tokens: 50}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 30, raw: "WHEN record_llm_call model=\"deepseek-chat\" input_tokens=100 output_tokens=50"}, 30)
    # line 31: WHEN reset_cost_tracker
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :reset_cost_tracker, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 31, raw: "WHEN reset_cost_tracker"}, 31)
    # line 32: THEN assert_cost_summary call_count=0
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_cost_summary, %{call_count: 0}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 32, raw: "THEN assert_cost_summary call_count=0"}, 32)
    _ctx = ctx
    :ok
  end

  # Source: COST-005
  @tag :cost
  @tag :unit
  test "[COST-005] history 返回时间序列表" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "COST-005"}
    # line 39: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 39, raw: "GIVEN create_temp_dir"}, 39)
    # line 40: WHEN init_cost_tracker
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :init_cost_tracker, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 40, raw: "WHEN init_cost_tracker"}, 40)
    # line 41: WHEN record_llm_call model="model-a" input_tokens=100 output_tokens=50
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :record_llm_call, %{input_tokens: 100, model: "model-a", output_tokens: 50}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 41, raw: "WHEN record_llm_call model=\"model-a\" input_tokens=100 output_tokens=50"}, 41)
    # line 42: WHEN record_llm_call model="model-b" input_tokens=200 output_tokens=100
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :record_llm_call, %{input_tokens: 200, model: "model-b", output_tokens: 100}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 42, raw: "WHEN record_llm_call model=\"model-b\" input_tokens=200 output_tokens=100"}, 42)
    # line 43: THEN assert_cost_history count=2 first_model="model-a"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_cost_history, %{count: 2, first_model: "model-a"}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 43, raw: "THEN assert_cost_history count=2 first_model=\"model-a\""}, 43)
    _ctx = ctx
    :ok
  end

  # Source: COST-006
  @tag :cost
  @tag :unit
  test "[COST-006] 空状态 last_call 为 nil" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "COST-006"}
    # line 46: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 46, raw: "GIVEN create_temp_dir"}, 46)
    # line 47: WHEN init_cost_tracker
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :init_cost_tracker, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 47, raw: "WHEN init_cost_tracker"}, 47)
    # line 48: THEN assert_last_call_nil
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_last_call_nil, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 48, raw: "THEN assert_last_call_nil"}, 48)
    _ctx = ctx
    :ok
  end

  # Source: COST-007
  @tag :cost
  @tag :unit
  test "[COST-007] 空状态 summary 全零" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "COST-007"}
    # line 51: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 51, raw: "GIVEN create_temp_dir"}, 51)
    # line 52: WHEN init_cost_tracker
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :init_cost_tracker, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 52, raw: "WHEN init_cost_tracker"}, 52)
    # line 53: THEN assert_cost_summary call_count=0 total_input=0 total_output=0
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_cost_summary, %{call_count: 0, total_input: 0, total_output: 0}, %{file: "/home/wangbo/document/gong/docs/bdd/cost_tracking.dsl", line: 53, raw: "THEN assert_cost_summary call_count=0 total_input=0 total_output=0"}, 53)
    _ctx = ctx
    :ok
  end

end
