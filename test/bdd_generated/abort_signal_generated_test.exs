# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/abort_signal.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.AbortSignalTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: ABORT-001
  @tag :abort
  @tag :integration
  test "[ABORT-001] 工具执行中 abort" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "ABORT-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 10, raw: "GIVEN configure_agent"}, 10)
    # line 11: GIVEN setup_abort_scenario after_tool=1
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :setup_abort_scenario, %{after_tool: 1}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 11, raw: "GIVEN setup_abort_scenario after_tool=1"}, 11)
    # line 12: GIVEN mock_llm_response response_type="tool_call" tool="bash" tool_args="command=echo running"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "bash", tool_args: "command=echo running"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 12, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"bash\" tool_args=\"command=echo running\""}, 12)
    # line 13: GIVEN mock_llm_response response_type="text" content="工具被中止"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "工具被中止", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 13, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"工具被中止\""}, 13)
    # line 14: WHEN agent_chat prompt="执行命令"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "执行命令"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 14, raw: "WHEN agent_chat prompt=\"执行命令\""}, 14)
    # line 15: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 15, raw: "THEN assert_no_crash"}, 15)
    _ctx = ctx
    :ok
  end

  # Source: ABORT-002
  @tag :abort
  @tag :integration
  test "[ABORT-002] 多工具 abort 跳过后续" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "ABORT-002"}
    # line 18: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 18, raw: "GIVEN create_temp_dir"}, 18)
    # line 19: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 19, raw: "GIVEN configure_agent"}, 19)
    # line 20: GIVEN setup_abort_scenario after_tool=1
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :setup_abort_scenario, %{after_tool: 1}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 20, raw: "GIVEN setup_abort_scenario after_tool=1"}, 20)
    # line 21: GIVEN mock_llm_response response_type="tool_call" tool="bash" tool_args="command=echo first" tool_id="tc1"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "bash", tool_args: "command=echo first", tool_id: "tc1"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 21, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"bash\" tool_args=\"command=echo first\" tool_id=\"tc1\""}, 21)
    # line 22: GIVEN mock_llm_response response_type="tool_call" tool="bash" tool_args="command=echo second" tool_id="tc2" batch_with_previous="true"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{batch_with_previous: "true", response_type: "tool_call", tool: "bash", tool_args: "command=echo second", tool_id: "tc2"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 22, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"bash\" tool_args=\"command=echo second\" tool_id=\"tc2\" batch_with_previous=\"true\""}, 22)
    # line 23: GIVEN mock_llm_response response_type="tool_call" tool="bash" tool_args="command=echo third" tool_id="tc3" batch_with_previous="true"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{batch_with_previous: "true", response_type: "tool_call", tool: "bash", tool_args: "command=echo third", tool_id: "tc3"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 23, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"bash\" tool_args=\"command=echo third\" tool_id=\"tc3\" batch_with_previous=\"true\""}, 23)
    # line 24: GIVEN mock_llm_response response_type="text" content="部分完成"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "部分完成", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 24, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"部分完成\""}, 24)
    # line 25: WHEN agent_chat prompt="执行三个命令"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "执行三个命令"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 25, raw: "WHEN agent_chat prompt=\"执行三个命令\""}, 25)
    # line 26: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 26, raw: "THEN assert_no_crash"}, 26)
    _ctx = ctx
    :ok
  end

  # Source: ABORT-003
  @tag :abort
  @tag :integration
  test "[ABORT-003] LLM 等待中 abort" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "ABORT-003"}
    # line 29: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 29, raw: "GIVEN create_temp_dir"}, 29)
    # line 30: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 30, raw: "GIVEN configure_agent"}, 30)
    # line 31: GIVEN mock_llm_response response_type="text" content="正常返回"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "正常返回", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 31, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"正常返回\""}, 31)
    # line 32: WHEN send_abort_signal
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :send_abort_signal, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 32, raw: "WHEN send_abort_signal"}, 32)
    # line 33: THEN assert_abort_reset
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_abort_reset, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 33, raw: "THEN assert_abort_reset"}, 33)
    # line 34: WHEN agent_chat prompt="你好"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "你好"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 34, raw: "WHEN agent_chat prompt=\"你好\""}, 34)
    # line 35: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 35, raw: "THEN assert_no_crash"}, 35)
    _ctx = ctx
    :ok
  end

  # Source: ABORT-004
  @tag :abort
  @tag :integration
  test "[ABORT-004] abort 后恢复" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "ABORT-004"}
    # line 38: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 38, raw: "GIVEN create_temp_dir"}, 38)
    # line 39: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 39, raw: "GIVEN configure_agent"}, 39)
    # line 40: WHEN send_abort_signal
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :send_abort_signal, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 40, raw: "WHEN send_abort_signal"}, 40)
    # line 41: THEN assert_abort_reset
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_abort_reset, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 41, raw: "THEN assert_abort_reset"}, 41)
    # line 42: GIVEN mock_llm_response response_type="text" content="恢复后正常"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "恢复后正常", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 42, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"恢复后正常\""}, 42)
    # line 43: WHEN agent_chat prompt="恢复测试"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "恢复测试"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 43, raw: "WHEN agent_chat prompt=\"恢复测试\""}, 43)
    # line 44: THEN assert_agent_reply contains="恢复后正常"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "恢复后正常"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 44, raw: "THEN assert_agent_reply contains=\"恢复后正常\""}, 44)
    # line 45: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 45, raw: "THEN assert_no_crash"}, 45)
    _ctx = ctx
    :ok
  end

  # Source: ABORT-005
  @tag :abort
  @tag :integration
  @tag :stream
  test "[ABORT-005] Partial content 保留" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "ABORT-005"}
    # line 48: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 48, raw: "GIVEN create_temp_dir"}, 48)
    # line 49: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 49, raw: "GIVEN configure_agent"}, 49)
    # line 50: GIVEN mock_stream_response chunks="chunk:已保留内容|abort:中断"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_stream_response, %{chunks: "chunk:已保留内容|abort:中断"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 50, raw: "GIVEN mock_stream_response chunks=\"chunk:已保留内容|abort:中断\""}, 50)
    # line 51: WHEN agent_stream prompt="流式中断"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "流式中断"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 51, raw: "WHEN agent_stream prompt=\"流式中断\""}, 51)
    # line 52: THEN assert_stream_content expected="已保留内容"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_content, %{expected: "已保留内容"}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 52, raw: "THEN assert_stream_content expected=\"已保留内容\""}, 52)
    # line 53: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/abort_signal.dsl", line: 53, raw: "THEN assert_no_crash"}, 53)
    _ctx = ctx
    :ok
  end

end
