# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/tool_extra.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.ToolExtraTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: TRUNC-001
  @tag :tool_extra
  @tag :unit
  test "[TRUNC-001] LLM 调用 truncate 加 max_lines 参数" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "TRUNC-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: GIVEN create_temp_file path="long_file.txt" content="line1\nline2\nline3\nline4\nline5\nline6\nline7\nline8\nline9\nline10"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "line1\\nline2\\nline3\\nline4\\nline5\\nline6\\nline7\\nline8\\nline9\\nline10", path: "long_file.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 10, raw: "GIVEN create_temp_file path=\"long_file.txt\" content=\"line1\\nline2\\nline3\\nline4\\nline5\\nline6\\nline7\\nline8\\nline9\\nline10\""}, 10)
    # line 11: WHEN tool_truncate path="long_file.txt" max_lines=5
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :tool_truncate, %{max_lines: 5, path: "long_file.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 11, raw: "WHEN tool_truncate path=\"long_file.txt\" max_lines=5"}, 11)
    # line 12: THEN assert_tool_success content_contains="line1"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_success, %{content_contains: "line1"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 12, raw: "THEN assert_tool_success content_contains=\"line1\""}, 12)
    _ctx = ctx
    :ok
  end

  # Source: TRUNC-002
  @tag :tool_extra
  @tag :unit
  test "[TRUNC-002] truncate 和系统截断交互" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "TRUNC-002"}
    # line 15: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 15, raw: "GIVEN create_temp_dir"}, 15)
    # line 16: GIVEN create_temp_file path="small.txt" content="one\ntwo\nthree"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "one\\ntwo\\nthree", path: "small.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 16, raw: "GIVEN create_temp_file path=\"small.txt\" content=\"one\\ntwo\\nthree\""}, 16)
    # line 17: WHEN tool_truncate path="small.txt" max_lines=100
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :tool_truncate, %{max_lines: 100, path: "small.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 17, raw: "WHEN tool_truncate path=\"small.txt\" max_lines=100"}, 17)
    # line 18: THEN assert_tool_success content_contains="one"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_success, %{content_contains: "one"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 18, raw: "THEN assert_tool_success content_contains=\"one\""}, 18)
    _ctx = ctx
    :ok
  end

  # Source: EDITDIFF-001
  @tag :tool_extra
  @tag :unit
  test "[EDITDIFF-001] unified diff 输入正确应用" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "EDITDIFF-001"}
    # line 25: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 25, raw: "GIVEN create_temp_dir"}, 25)
    # line 26: GIVEN create_temp_file path="target.txt" content="aaa\nbbb\nccc\nddd"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "aaa\\nbbb\\nccc\\nddd", path: "target.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 26, raw: "GIVEN create_temp_file path=\"target.txt\" content=\"aaa\\nbbb\\nccc\\nddd\""}, 26)
    # line 27: WHEN tool_edit_diff path="target.txt" diff="@@ -1,4 +1,4 @@\n aaa\n-bbb\n+BBB\n ccc\n ddd"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :tool_edit_diff, %{diff: "@@ -1,4 +1,4 @@\\n aaa\\n-bbb\\n+BBB\\n ccc\\n ddd", path: "target.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 27, raw: "WHEN tool_edit_diff path=\"target.txt\" diff=\"@@ -1,4 +1,4 @@\\n aaa\\n-bbb\\n+BBB\\n ccc\\n ddd\""}, 27)
    # line 28: THEN assert_tool_success
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_success, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 28, raw: "THEN assert_tool_success"}, 28)
    # line 29: THEN assert_file_content path="target.txt" expected="aaa\nBBB\nccc\nddd"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_file_content, %{expected: "aaa\\nBBB\\nccc\\nddd", path: "target.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 29, raw: "THEN assert_file_content path=\"target.txt\" expected=\"aaa\\nBBB\\nccc\\nddd\""}, 29)
    _ctx = ctx
    :ok
  end

  # Source: EDITDIFF-002
  @tag :tool_extra
  @tag :unit
  test "[EDITDIFF-002] diff 加行偏移定位正确" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "EDITDIFF-002"}
    # line 32: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 32, raw: "GIVEN create_temp_dir"}, 32)
    # line 33: GIVEN create_temp_file path="offset.txt" content="header\n---\nalpha\nbeta\ngamma"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "header\\n---\\nalpha\\nbeta\\ngamma", path: "offset.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 33, raw: "GIVEN create_temp_file path=\"offset.txt\" content=\"header\\n---\\nalpha\\nbeta\\ngamma\""}, 33)
    # line 34: WHEN tool_edit_diff path="offset.txt" diff="@@ -3,3 +3,3 @@\n alpha\n-beta\n+BETA\n gamma"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :tool_edit_diff, %{diff: "@@ -3,3 +3,3 @@\\n alpha\\n-beta\\n+BETA\\n gamma", path: "offset.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 34, raw: "WHEN tool_edit_diff path=\"offset.txt\" diff=\"@@ -3,3 +3,3 @@\\n alpha\\n-beta\\n+BETA\\n gamma\""}, 34)
    # line 35: THEN assert_tool_success
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_success, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 35, raw: "THEN assert_tool_success"}, 35)
    # line 36: THEN assert_file_content path="offset.txt" expected="header\n---\nalpha\nBETA\ngamma"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_file_content, %{expected: "header\\n---\\nalpha\\nBETA\\ngamma", path: "offset.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 36, raw: "THEN assert_file_content path=\"offset.txt\" expected=\"header\\n---\\nalpha\\nBETA\\ngamma\""}, 36)
    _ctx = ctx
    :ok
  end

  # Source: EDITDIFF-003
  @tag :tool_extra
  @tag :unit
  test "[EDITDIFF-003] diff 和 string replace 混合使用" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "EDITDIFF-003"}
    # line 39: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 39, raw: "GIVEN create_temp_dir"}, 39)
    # line 40: GIVEN create_temp_file path="mixed.txt" content="foo\nbar\nbaz"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "foo\\nbar\\nbaz", path: "mixed.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 40, raw: "GIVEN create_temp_file path=\"mixed.txt\" content=\"foo\\nbar\\nbaz\""}, 40)
    # line 41: WHEN tool_edit_diff path="mixed.txt" diff="@@ -1,3 +1,3 @@\n foo\n-bar\n+BAR\n baz"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :tool_edit_diff, %{diff: "@@ -1,3 +1,3 @@\\n foo\\n-bar\\n+BAR\\n baz", path: "mixed.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 41, raw: "WHEN tool_edit_diff path=\"mixed.txt\" diff=\"@@ -1,3 +1,3 @@\\n foo\\n-bar\\n+BAR\\n baz\""}, 41)
    # line 42: THEN assert_tool_success
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_success, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 42, raw: "THEN assert_tool_success"}, 42)
    # line 43: THEN assert_file_content path="mixed.txt" expected="foo\nBAR\nbaz"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_file_content, %{expected: "foo\\nBAR\\nbaz", path: "mixed.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 43, raw: "THEN assert_file_content path=\"mixed.txt\" expected=\"foo\\nBAR\\nbaz\""}, 43)
    _ctx = ctx
    :ok
  end

  # Source: PATH-001
  @tag :tool_extra
  @tag :unit
  test "[PATH-001] 波浪号相对路径点点全部规范化" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "PATH-001"}
    # line 50: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 50, raw: "GIVEN create_temp_dir"}, 50)
    # line 51: WHEN normalize_path path="/tmp/foo/../bar"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :normalize_path, %{path: "/tmp/foo/../bar"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 51, raw: "WHEN normalize_path path=\"/tmp/foo/../bar\""}, 51)
    # line 52: THEN assert_normalized_path expected="/tmp/bar"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_normalized_path, %{expected: "/tmp/bar"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 52, raw: "THEN assert_normalized_path expected=\"/tmp/bar\""}, 52)
    _ctx = ctx
    :ok
  end

  # Source: PATH-002
  @tag :tool_extra
  @tag :unit
  test "[PATH-002] macOS NFD 变体处理" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "PATH-002"}
    # line 55: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 55, raw: "GIVEN create_temp_dir"}, 55)
    # line 56: WHEN normalize_path path="/tmp/test"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :normalize_path, %{path: "/tmp/test"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 56, raw: "WHEN normalize_path path=\"/tmp/test\""}, 56)
    # line 57: THEN assert_normalized_path expected="/tmp/test"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_normalized_path, %{expected: "/tmp/test"}, %{file: "/home/wangbo/document/gong/docs/bdd/tool_extra.dsl", line: 57, raw: "THEN assert_normalized_path expected=\"/tmp/test\""}, 57)
    _ctx = ctx
    :ok
  end

end
