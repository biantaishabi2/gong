# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/rpc.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.RpcTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: RPC-001
  @tag :rpc
  @tag :unit
  test "[RPC-001] 解析有效 JSON-RPC 请求" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "RPC-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: WHEN parse_rpc_request json="{\"jsonrpc\":\"2.0\",\"method\":\"chat\",\"params\":{},\"id\":1}"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :parse_rpc_request, %{json: "{\\\"jsonrpc\\\":\\\"2.0\\\",\\\"method\\\":\\\"chat\\\",\\\"params\\\":{},\\\"id\\\":1}"}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 10, raw: "WHEN parse_rpc_request json=\"{\\\"jsonrpc\\\":\\\"2.0\\\",\\\"method\\\":\\\"chat\\\",\\\"params\\\":{},\\\"id\\\":1}\""}, 10)
    # line 11: THEN assert_rpc_parsed method="chat"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_rpc_parsed, %{method: "chat"}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 11, raw: "THEN assert_rpc_parsed method=\"chat\""}, 11)
    _ctx = ctx
    :ok
  end

  # Source: RPC-002
  @tag :rpc
  @tag :unit
  test "[RPC-002] 解析无效 JSON 返回错误" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "RPC-002"}
    # line 14: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 14, raw: "GIVEN create_temp_dir"}, 14)
    # line 15: WHEN parse_rpc_request json="not json"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :parse_rpc_request, %{json: "not json"}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 15, raw: "WHEN parse_rpc_request json=\"not json\""}, 15)
    # line 16: THEN assert_rpc_error code=-32700
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_rpc_error, %{code: -32700}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 16, raw: "THEN assert_rpc_error code=-32700"}, 16)
    _ctx = ctx
    :ok
  end

  # Source: RPC-003
  @tag :rpc
  @tag :unit
  test "[RPC-003] 分发到已注册方法" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "RPC-003"}
    # line 19: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 19, raw: "GIVEN create_temp_dir"}, 19)
    # line 20: WHEN rpc_dispatch method="echo" params="{\"msg\":\"hello\"}"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :rpc_dispatch, %{method: "echo", params: "{\\\"msg\\\":\\\"hello\\\"}"}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 20, raw: "WHEN rpc_dispatch method=\"echo\" params=\"{\\\"msg\\\":\\\"hello\\\"}\""}, 20)
    # line 21: THEN assert_rpc_result contains="hello"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_rpc_result, %{contains: "hello"}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 21, raw: "THEN assert_rpc_result contains=\"hello\""}, 21)
    _ctx = ctx
    :ok
  end

  # Source: RPC-004
  @tag :rpc
  @tag :unit
  test "[RPC-004] 分发到不存在方法" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "RPC-004"}
    # line 24: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 24, raw: "GIVEN create_temp_dir"}, 24)
    # line 25: WHEN rpc_dispatch_missing method="nonexistent"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :rpc_dispatch_missing, %{method: "nonexistent"}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 25, raw: "WHEN rpc_dispatch_missing method=\"nonexistent\""}, 25)
    # line 26: THEN assert_rpc_error code=-32601
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_rpc_error, %{code: -32601}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 26, raw: "THEN assert_rpc_error code=-32601"}, 26)
    _ctx = ctx
    :ok
  end

  # Source: RPC-005
  @tag :rpc
  @tag :unit
  test "[RPC-005] 完整 handle 调用流程" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "RPC-005"}
    # line 29: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 29, raw: "GIVEN create_temp_dir"}, 29)
    # line 30: WHEN rpc_handle json="{\"jsonrpc\":\"2.0\",\"method\":\"echo\",\"params\":{\"msg\":\"test\"},\"id\":42}"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :rpc_handle, %{json: "{\\\"jsonrpc\\\":\\\"2.0\\\",\\\"method\\\":\\\"echo\\\",\\\"params\\\":{\\\"msg\\\":\\\"test\\\"},\\\"id\\\":42}"}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 30, raw: "WHEN rpc_handle json=\"{\\\"jsonrpc\\\":\\\"2.0\\\",\\\"method\\\":\\\"echo\\\",\\\"params\\\":{\\\"msg\\\":\\\"test\\\"},\\\"id\\\":42}\""}, 30)
    # line 31: THEN assert_rpc_response_json contains="test"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_rpc_response_json, %{contains: "test"}, %{file: "/home/wangbo/document/gong/docs/bdd/rpc.dsl", line: 31, raw: "THEN assert_rpc_response_json contains=\"test\""}, 31)
    _ctx = ctx
    :ok
  end

end
