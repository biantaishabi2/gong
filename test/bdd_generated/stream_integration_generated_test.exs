# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/stream_integration.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.StreamIntegrationTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: STREAM-001
  @tag :integration
  @tag :stream
  test "[STREAM-001] 纯文本流式" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 10, raw: "GIVEN configure_agent"}, 10)
    # line 11: GIVEN mock_stream_response chunks="chunk:你好|chunk:世界|chunk:！|done"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_stream_response, %{chunks: "chunk:你好|chunk:世界|chunk:！|done"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 11, raw: "GIVEN mock_stream_response chunks=\"chunk:你好|chunk:世界|chunk:！|done\""}, 11)
    # line 12: WHEN agent_stream prompt="测试流式"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "测试流式"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 12, raw: "WHEN agent_stream prompt=\"测试流式\""}, 12)
    # line 13: THEN assert_stream_events sequence="start,delta,end"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_events, %{sequence: "start,delta,end"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 13, raw: "THEN assert_stream_events sequence=\"start,delta,end\""}, 13)
    # line 14: THEN assert_stream_content expected="你好世界！"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_content, %{expected: "你好世界！"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 14, raw: "THEN assert_stream_content expected=\"你好世界！\""}, 14)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-002
  @tag :integration
  @tag :stream
  test "[STREAM-002]" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-002"}
    # line 17: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 17, raw: "GIVEN create_temp_dir"}, 17)
    # line 18: GIVEN create_temp_file path="stream.txt" content="tool_stream_test"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "tool_stream_test", path: "stream.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 18, raw: "GIVEN create_temp_file path=\"stream.txt\" content=\"tool_stream_test\""}, 18)
    # line 19: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 19, raw: "GIVEN configure_agent"}, 19)
    # line 20: GIVEN mock_llm_response response_type="tool_call" tool="read_file" tool_args="file_path={{workspace}}/stream.txt"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "read_file", tool_args: "file_path={{workspace}}/stream.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 20, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"read_file\" tool_args=\"file_path={{workspace}}/stream.txt\""}, 20)
    # line 21: GIVEN mock_llm_response response_type="text" content="流式工具调用完成"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "流式工具调用完成", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 21, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"流式工具调用完成\""}, 21)
    # line 22: WHEN agent_stream prompt="流式读文件"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "流式读文件"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 22, raw: "WHEN agent_stream prompt=\"流式读文件\""}, 22)
    # line 23: THEN assert_tool_was_called tool="read_file"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "read_file"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 23, raw: "THEN assert_tool_was_called tool=\"read_file\""}, 23)
    # line 24: THEN assert_stream_events sequence="start,delta,end"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_events, %{sequence: "start,delta,end"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 24, raw: "THEN assert_stream_events sequence=\"start,delta,end\""}, 24)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-003
  @tag :integration
  @tag :stream
  test "[STREAM-003] 流式中断有内容" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-003"}
    # line 27: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 27, raw: "GIVEN create_temp_dir"}, 27)
    # line 28: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 28, raw: "GIVEN configure_agent"}, 28)
    # line 29: GIVEN mock_stream_response chunks="chunk:已收到|abort:用户中断"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_stream_response, %{chunks: "chunk:已收到|abort:用户中断"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 29, raw: "GIVEN mock_stream_response chunks=\"chunk:已收到|abort:用户中断\""}, 29)
    # line 30: WHEN agent_stream prompt="测试中断"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "测试中断"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 30, raw: "WHEN agent_stream prompt=\"测试中断\""}, 30)
    # line 31: THEN assert_stream_events sequence="start,delta,end"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_events, %{sequence: "start,delta,end"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 31, raw: "THEN assert_stream_events sequence=\"start,delta,end\""}, 31)
    # line 32: THEN assert_stream_content expected="已收到"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_content, %{expected: "已收到"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 32, raw: "THEN assert_stream_content expected=\"已收到\""}, 32)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-004
  @tag :integration
  @tag :stream
  test "[STREAM-004] 空内容中断" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-004"}
    # line 35: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 35, raw: "GIVEN create_temp_dir"}, 35)
    # line 36: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 36, raw: "GIVEN configure_agent"}, 36)
    # line 37: GIVEN mock_stream_response chunks="abort:立即中断"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_stream_response, %{chunks: "abort:立即中断"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 37, raw: "GIVEN mock_stream_response chunks=\"abort:立即中断\""}, 37)
    # line 38: WHEN agent_stream prompt="测试空中断"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "测试空中断"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 38, raw: "WHEN agent_stream prompt=\"测试空中断\""}, 38)
    # line 39: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 39, raw: "THEN assert_no_crash"}, 39)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-005
  @tag :integration
  @tag :stream
  test "[STREAM-005] 事件序列正确" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-005"}
    # line 42: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 42, raw: "GIVEN create_temp_dir"}, 42)
    # line 43: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 43, raw: "GIVEN configure_agent"}, 43)
    # line 44: GIVEN mock_stream_response chunks="chunk:A|chunk:B|chunk:C|done"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_stream_response, %{chunks: "chunk:A|chunk:B|chunk:C|done"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 44, raw: "GIVEN mock_stream_response chunks=\"chunk:A|chunk:B|chunk:C|done\""}, 44)
    # line 45: WHEN agent_stream prompt="序列测试"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "序列测试"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 45, raw: "WHEN agent_stream prompt=\"序列测试\""}, 45)
    # line 46: THEN assert_stream_events sequence="start,delta,end"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_events, %{sequence: "start,delta,end"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 46, raw: "THEN assert_stream_events sequence=\"start,delta,end\""}, 46)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-006
  @tag :integration
  @tag :stream
  test "[STREAM-006] 流式加 Hook" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-006"}
    # line 49: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 49, raw: "GIVEN create_temp_dir"}, 49)
    # line 50: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 50, raw: "GIVEN configure_agent"}, 50)
    # line 51: GIVEN register_hook module="AllowAll"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :register_hook, %{module: "AllowAll"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 51, raw: "GIVEN register_hook module=\"AllowAll\""}, 51)
    # line 52: GIVEN mock_llm_response response_type="text" content="Hook流式测试"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "Hook流式测试", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 52, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"Hook流式测试\""}, 52)
    # line 53: WHEN agent_stream prompt="流式Hook"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "流式Hook"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 53, raw: "WHEN agent_stream prompt=\"流式Hook\""}, 53)
    # line 54: THEN assert_stream_events sequence="start,delta,end"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_events, %{sequence: "start,delta,end"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 54, raw: "THEN assert_stream_events sequence=\"start,delta,end\""}, 54)
    # line 55: THEN assert_agent_reply contains="Hook流式测试"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "Hook流式测试"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 55, raw: "THEN assert_agent_reply contains=\"Hook流式测试\""}, 55)
    # line 56: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 56, raw: "THEN assert_no_crash"}, 56)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-007
  @tag :integration
  @tag :stream
  test "[STREAM-007] 流式超时" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-007"}
    # line 59: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 59, raw: "GIVEN create_temp_dir"}, 59)
    # line 60: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 60, raw: "GIVEN configure_agent"}, 60)
    # line 61: GIVEN mock_stream_response chunks="chunk:开始|delay:6000|chunk:超时|done"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_stream_response, %{chunks: "chunk:开始|delay:6000|chunk:超时|done"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 61, raw: "GIVEN mock_stream_response chunks=\"chunk:开始|delay:6000|chunk:超时|done\""}, 61)
    # line 62: WHEN agent_stream prompt="超时测试"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "超时测试"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 62, raw: "WHEN agent_stream prompt=\"超时测试\""}, 62)
    # line 63: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 63, raw: "THEN assert_no_crash"}, 63)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-008
  @tag :e2e
  @tag :integration
  @tag :stream
  test "[STREAM-008] E2E 真实流" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-008"}
    # line 66: GIVEN check_e2e_provider
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :check_e2e_provider, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 66, raw: "GIVEN check_e2e_provider"}, 66)
    # line 67: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 67, raw: "GIVEN create_temp_dir"}, 67)
    # line 68: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 68, raw: "GIVEN configure_agent"}, 68)
    # line 69: WHEN agent_stream prompt="1加1等于几？只回答数字"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "1加1等于几？只回答数字"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 69, raw: "WHEN agent_stream prompt=\"1加1等于几？只回答数字\""}, 69)
    # line 70: THEN assert_stream_events sequence="start,delta,end"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_stream_events, %{sequence: "start,delta,end"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 70, raw: "THEN assert_stream_events sequence=\"start,delta,end\""}, 70)
    # line 71: THEN assert_agent_reply contains="2"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "2"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_integration.dsl", line: 71, raw: "THEN assert_agent_reply contains=\"2\""}, 71)
    _ctx = ctx
    :ok
  end

end
