# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/stream_edge.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.StreamEdgeTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: STREAM-ERR-001
  @tag :integration
  @tag :stream
  test "[STREAM-ERR-001] 流中途中断返回部分结果" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-ERR-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: GIVEN configure_agent model="mock"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{model: "mock"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 10, raw: "GIVEN configure_agent model=\"mock\""}, 10)
    # line 11: GIVEN mock_stream_response chunks="hello|world|__INTERRUPT__"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_stream_response, %{chunks: "hello|world|__INTERRUPT__"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 11, raw: "GIVEN mock_stream_response chunks=\"hello|world|__INTERRUPT__\""}, 11)
    # line 12: WHEN agent_stream prompt="test"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_stream, %{prompt: "test"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 12, raw: "WHEN agent_stream prompt=\"test\""}, 12)
    # line 13: THEN assert_partial_content contains="hello"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_partial_content, %{contains: "hello"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 13, raw: "THEN assert_partial_content contains=\"hello\""}, 13)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-ERR-002
  @tag :partial_json
  @tag :unit
  test "[STREAM-ERR-002] 增量 JSON 在 key 截断位置的容错" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-ERR-002"}
    # line 16: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 16, raw: "GIVEN create_temp_dir"}, 16)
    # line 17: WHEN partial_json_parse input="{\"name\": \"val"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :partial_json_parse, %{input: "{\\\"name\\\": \\\"val"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 17, raw: "WHEN partial_json_parse input=\"{\\\"name\\\": \\\"val\""}, 17)
    # line 18: THEN assert_partial_json_field key="name" expected="val"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_partial_json_field, %{expected: "val", key: "name"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 18, raw: "THEN assert_partial_json_field key=\"name\" expected=\"val\""}, 18)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-ERR-003
  @tag :stream
  @tag :unit
  test "[STREAM-ERR-003] 工具调用流式参数完整组装" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-ERR-003"}
    # line 21: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 21, raw: "GIVEN create_temp_dir"}, 21)
    # line 22: WHEN stream_tool_chunks tool_name="tool_bash" chunks="{\"comm|and\": \"echo|hello\"}"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :stream_tool_chunks, %{chunks: "{\\\"comm|and\\\": \\\"echo|hello\\\"}", tool_name: "tool_bash"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 22, raw: "WHEN stream_tool_chunks tool_name=\"tool_bash\" chunks=\"{\\\"comm|and\\\": \\\"echo|hello\\\"}\""}, 22)
    # line 23: THEN assert_tool_event_sequence sequence="tool_start,tool_delta,tool_delta,tool_delta,tool_end"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_event_sequence, %{sequence: "tool_start,tool_delta,tool_delta,tool_delta,tool_end"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 23, raw: "THEN assert_tool_event_sequence sequence=\"tool_start,tool_delta,tool_delta,tool_delta,tool_end\""}, 23)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-ERR-004
  @tag :stream
  @tag :unit
  test "[STREAM-ERR-004] Hook/命令在活跃流式期间执行的并发安全" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-ERR-004"}
    # line 30: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 30, raw: "GIVEN create_temp_dir"}, 30)
    # line 31: WHEN start_mock_stream
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :start_mock_stream, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 31, raw: "WHEN start_mock_stream"}, 31)
    # line 32: WHEN execute_hook_during_stream hook_module="AllowAll"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :execute_hook_during_stream, %{hook_module: "AllowAll"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 32, raw: "WHEN execute_hook_during_stream hook_module=\"AllowAll\""}, 32)
    # line 33: THEN assert_no_race_condition
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_race_condition, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 33, raw: "THEN assert_no_race_condition"}, 33)
    _ctx = ctx
    :ok
  end

  # Source: STREAM-ERR-005
  @tag :stream
  @tag :unit
  test "[STREAM-ERR-005] 缺少 start 的事件序列被拒绝" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "STREAM-ERR-005"}
    # line 36: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 36, raw: "GIVEN create_temp_dir"}, 36)
    # line 37: WHEN validate_stream_events types="text_delta,text_end"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :validate_stream_events, %{types: "text_delta,text_end"}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 37, raw: "WHEN validate_stream_events types=\"text_delta,text_end\""}, 37)
    # line 38: THEN assert_sequence_invalid
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_sequence_invalid, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/stream_edge.dsl", line: 38, raw: "THEN assert_sequence_invalid"}, 38)
    _ctx = ctx
    :ok
  end

end
