# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/auth.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.AuthTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: AUTH-001
  @tag :auth
  @tag :unit
  test "[AUTH-001] API Key 认证方式检测" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: WHEN detect_auth_method provider="deepseek"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :detect_auth_method, %{provider: "deepseek"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 10, raw: "WHEN detect_auth_method provider=\"deepseek\""}, 10)
    # line 11: THEN assert_auth_method expected="api_key"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_auth_method, %{expected: "api_key"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 11, raw: "THEN assert_auth_method expected=\"api_key\""}, 11)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-002
  @tag :auth
  @tag :unit
  test "[AUTH-002] OAuth 认证方式检测" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-002"}
    # line 14: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 14, raw: "GIVEN create_temp_dir"}, 14)
    # line 15: WHEN detect_auth_method provider="anthropic"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :detect_auth_method, %{provider: "anthropic"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 15, raw: "WHEN detect_auth_method provider=\"anthropic\""}, 15)
    # line 16: THEN assert_auth_method expected="oauth"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_auth_method, %{expected: "oauth"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 16, raw: "THEN assert_auth_method expected=\"oauth\""}, 16)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-003
  @tag :auth
  @tag :unit
  test "[AUTH-003] OAuth 授权 URL 生成" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-003"}
    # line 19: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 19, raw: "GIVEN create_temp_dir"}, 19)
    # line 20: WHEN generate_authorize_url client_id="test_client" authorize_url="https://auth.example.com/authorize"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :generate_authorize_url, %{authorize_url: "https://auth.example.com/authorize", client_id: "test_client"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 20, raw: "WHEN generate_authorize_url client_id=\"test_client\" authorize_url=\"https://auth.example.com/authorize\""}, 20)
    # line 21: THEN assert_authorize_url contains="client_id=test_client"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_authorize_url, %{contains: "client_id=test_client"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 21, raw: "THEN assert_authorize_url contains=\"client_id=test_client\""}, 21)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-004
  @tag :auth
  @tag :unit
  test "[AUTH-004] 授权码交换 token" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-004"}
    # line 24: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 24, raw: "GIVEN create_temp_dir"}, 24)
    # line 25: WHEN exchange_auth_code code="test_code_123"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :exchange_auth_code, %{code: "test_code_123"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 25, raw: "WHEN exchange_auth_code code=\"test_code_123\""}, 25)
    # line 26: THEN assert_auth_token contains="test_code_123"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_auth_token, %{contains: "test_code_123"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 26, raw: "THEN assert_auth_token contains=\"test_code_123\""}, 26)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-005
  @tag :auth
  @tag :unit
  test "[AUTH-005] 刷新 token" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-005"}
    # line 33: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 33, raw: "GIVEN create_temp_dir"}, 33)
    # line 34: WHEN refresh_auth_token refresh="mock_refresh_abc"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :refresh_auth_token, %{refresh: "mock_refresh_abc"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 34, raw: "WHEN refresh_auth_token refresh=\"mock_refresh_abc\""}, 34)
    # line 35: THEN assert_auth_token contains="refreshed_access"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_auth_token, %{contains: "refreshed_access"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 35, raw: "THEN assert_auth_token contains=\"refreshed_access\""}, 35)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-006
  @tag :auth
  @tag :unit
  test "[AUTH-006] token 过期检测" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-006"}
    # line 38: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 38, raw: "GIVEN create_temp_dir"}, 38)
    # line 39: WHEN check_token_expired expires_at=0
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :check_token_expired, %{expires_at: 0}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 39, raw: "WHEN check_token_expired expires_at=0"}, 39)
    # line 40: THEN assert_token_expired expected="true"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_token_expired, %{expected: "true"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 40, raw: "THEN assert_token_expired expected=\"true\""}, 40)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-007
  @tag :auth
  @tag :unit
  test "[AUTH-007] token 未过期检测" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-007"}
    # line 43: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 43, raw: "GIVEN create_temp_dir"}, 43)
    # line 44: WHEN check_token_expired expires_at=9999999999
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :check_token_expired, %{expires_at: 9999999999}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 44, raw: "WHEN check_token_expired expires_at=9999999999"}, 44)
    # line 45: THEN assert_token_expired expected="false"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_token_expired, %{expected: "false"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 45, raw: "THEN assert_token_expired expected=\"false\""}, 45)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-008
  @tag :auth
  @tag :unit
  test "[AUTH-008] 获取 API Key 成功" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-008"}
    # line 48: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 48, raw: "GIVEN create_temp_dir"}, 48)
    # line 49: WHEN get_api_key env_var="GONG_TEST_API_KEY"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :get_api_key, %{env_var: "GONG_TEST_API_KEY"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 49, raw: "WHEN get_api_key env_var=\"GONG_TEST_API_KEY\""}, 49)
    # line 50: THEN assert_api_key_result status="ok"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_api_key_result, %{status: "ok"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 50, raw: "THEN assert_api_key_result status=\"ok\""}, 50)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-009
  @tag :auth
  @tag :unit
  test "[AUTH-009] 获取 API Key 缺失" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-009"}
    # line 53: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 53, raw: "GIVEN create_temp_dir"}, 53)
    # line 54: WHEN get_api_key env_var="GONG_NONEXISTENT_VAR_12345"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :get_api_key, %{env_var: "GONG_NONEXISTENT_VAR_12345"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 54, raw: "WHEN get_api_key env_var=\"GONG_NONEXISTENT_VAR_12345\""}, 54)
    # line 55: THEN assert_api_key_result status="error"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_api_key_result, %{status: "error"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth.dsl", line: 55, raw: "THEN assert_api_key_result status=\"error\""}, 55)
    _ctx = ctx
    :ok
  end

end
