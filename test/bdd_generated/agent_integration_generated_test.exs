# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/agent_integration.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.AgentIntegrationTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: BDD-AGENT-001
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-001] 简单文本回复" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-001"}
    # line 10: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 10, raw: "GIVEN create_temp_dir"}, 10)
    # line 11: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 11, raw: "GIVEN configure_agent"}, 11)
    # line 12: GIVEN mock_llm_response response_type="text" content="你好，我是 Gong！"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "你好，我是 Gong！", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 12, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"你好，我是 Gong！\""}, 12)
    # line 13: WHEN agent_chat prompt="你好"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "你好"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 13, raw: "WHEN agent_chat prompt=\"你好\""}, 13)
    # line 14: THEN assert_agent_reply contains="你好"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "你好"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 14, raw: "THEN assert_agent_reply contains=\"你好\""}, 14)
    # line 15: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 15, raw: "THEN assert_no_crash"}, 15)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-002
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-002] 单工具调用后回复" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-002"}
    # line 18: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 18, raw: "GIVEN create_temp_dir"}, 18)
    # line 19: GIVEN create_temp_file path="hello.txt" content="Hello World"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "Hello World", path: "hello.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 19, raw: "GIVEN create_temp_file path=\"hello.txt\" content=\"Hello World\""}, 19)
    # line 20: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 20, raw: "GIVEN configure_agent"}, 20)
    # line 21: GIVEN mock_llm_response response_type="tool_call" tool="read_file" tool_args="file_path={{workspace}}/hello.txt"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "read_file", tool_args: "file_path={{workspace}}/hello.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 21, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"read_file\" tool_args=\"file_path={{workspace}}/hello.txt\""}, 21)
    # line 22: GIVEN mock_llm_response response_type="text" content="文件内容是 Hello World"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "文件内容是 Hello World", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 22, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"文件内容是 Hello World\""}, 22)
    # line 23: WHEN agent_chat prompt="读一下 hello.txt"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "读一下 hello.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 23, raw: "WHEN agent_chat prompt=\"读一下 hello.txt\""}, 23)
    # line 24: THEN assert_agent_reply contains="Hello World"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "Hello World"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 24, raw: "THEN assert_agent_reply contains=\"Hello World\""}, 24)
    # line 25: THEN assert_tool_was_called tool="read_file"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "read_file"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 25, raw: "THEN assert_tool_was_called tool=\"read_file\""}, 25)
    # line 26: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 26, raw: "THEN assert_no_crash"}, 26)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-003
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-003] 多工具链式调用" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-003"}
    # line 29: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 29, raw: "GIVEN create_temp_dir"}, 29)
    # line 30: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 30, raw: "GIVEN configure_agent"}, 30)
    # line 31: GIVEN mock_llm_response response_type="tool_call" tool="bash" tool_args="command=echo hello"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "bash", tool_args: "command=echo hello"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 31, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"bash\" tool_args=\"command=echo hello\""}, 31)
    # line 32: GIVEN mock_llm_response response_type="tool_call" tool="bash" tool_args="command=echo world"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "bash", tool_args: "command=echo world"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 32, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"bash\" tool_args=\"command=echo world\""}, 32)
    # line 33: GIVEN mock_llm_response response_type="text" content="执行完毕"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "执行完毕", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 33, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"执行完毕\""}, 33)
    # line 34: WHEN agent_chat prompt="先输出 hello 再输出 world"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "先输出 hello 再输出 world"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 34, raw: "WHEN agent_chat prompt=\"先输出 hello 再输出 world\""}, 34)
    # line 35: THEN assert_tool_was_called tool="bash" times=2
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{times: 2, tool: "bash"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 35, raw: "THEN assert_tool_was_called tool=\"bash\" times=2"}, 35)
    # line 36: THEN assert_agent_reply contains="执行完毕"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "执行完毕"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 36, raw: "THEN assert_agent_reply contains=\"执行完毕\""}, 36)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-004
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-004] 工具写入文件验证" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-004"}
    # line 39: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 39, raw: "GIVEN create_temp_dir"}, 39)
    # line 40: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 40, raw: "GIVEN configure_agent"}, 40)
    # line 41: GIVEN mock_llm_response response_type="tool_call" tool="write_file" tool_args="file_path={{workspace}}/output.txt|content=written by gong"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "write_file", tool_args: "file_path={{workspace}}/output.txt|content=written by gong"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 41, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"write_file\" tool_args=\"file_path={{workspace}}/output.txt|content=written by gong\""}, 41)
    # line 42: GIVEN mock_llm_response response_type="text" content="文件已写入"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "文件已写入", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 42, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"文件已写入\""}, 42)
    # line 43: WHEN agent_chat prompt="写一个文件"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "写一个文件"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 43, raw: "WHEN agent_chat prompt=\"写一个文件\""}, 43)
    # line 44: THEN assert_agent_reply contains="文件已写入"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "文件已写入"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 44, raw: "THEN assert_agent_reply contains=\"文件已写入\""}, 44)
    # line 45: THEN assert_file_exists path="output.txt"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_file_exists, %{path: "output.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 45, raw: "THEN assert_file_exists path=\"output.txt\""}, 45)
    # line 46: THEN assert_file_content path="output.txt" expected="written by gong"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_file_content, %{expected: "written by gong", path: "output.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 46, raw: "THEN assert_file_content path=\"output.txt\" expected=\"written by gong\""}, 46)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-005
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-005] 工具编辑文件" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-005"}
    # line 49: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 49, raw: "GIVEN create_temp_dir"}, 49)
    # line 50: GIVEN create_temp_file path="code.py" content="print('hello')"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "print('hello')", path: "code.py"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 50, raw: "GIVEN create_temp_file path=\"code.py\" content=\"print('hello')\""}, 50)
    # line 51: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 51, raw: "GIVEN configure_agent"}, 51)
    # line 52: GIVEN mock_llm_response response_type="tool_call" tool="edit_file" tool_args="file_path={{workspace}}/code.py|old_string=hello|new_string=world"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "edit_file", tool_args: "file_path={{workspace}}/code.py|old_string=hello|new_string=world"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 52, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"edit_file\" tool_args=\"file_path={{workspace}}/code.py|old_string=hello|new_string=world\""}, 52)
    # line 53: GIVEN mock_llm_response response_type="text" content="已修改"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "已修改", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 53, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"已修改\""}, 53)
    # line 54: WHEN agent_chat prompt="把 hello 改成 world"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "把 hello 改成 world"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 54, raw: "WHEN agent_chat prompt=\"把 hello 改成 world\""}, 54)
    # line 55: THEN assert_agent_reply contains="已修改"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "已修改"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 55, raw: "THEN assert_agent_reply contains=\"已修改\""}, 55)
    # line 56: THEN assert_file_content path="code.py" expected="print('world')"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_file_content, %{expected: "print('world')", path: "code.py"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 56, raw: "THEN assert_file_content path=\"code.py\" expected=\"print('world')\""}, 56)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-006
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-006] grep 搜索工具" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-006"}
    # line 59: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 59, raw: "GIVEN create_temp_dir"}, 59)
    # line 60: GIVEN create_temp_file path="src/main.py" content="def main():\n    print('hello')"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "def main():\\n    print('hello')", path: "src/main.py"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 60, raw: "GIVEN create_temp_file path=\"src/main.py\" content=\"def main():\\n    print('hello')\""}, 60)
    # line 61: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 61, raw: "GIVEN configure_agent"}, 61)
    # line 62: GIVEN mock_llm_response response_type="tool_call" tool="grep" tool_args="pattern=main|path={{workspace}}"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "grep", tool_args: "pattern=main|path={{workspace}}"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 62, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"grep\" tool_args=\"pattern=main|path={{workspace}}\""}, 62)
    # line 63: GIVEN mock_llm_response response_type="text" content="找到 main 函数定义"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "找到 main 函数定义", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 63, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"找到 main 函数定义\""}, 63)
    # line 64: WHEN agent_chat prompt="搜索 main"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "搜索 main"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 64, raw: "WHEN agent_chat prompt=\"搜索 main\""}, 64)
    # line 65: THEN assert_tool_was_called tool="grep"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "grep"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 65, raw: "THEN assert_tool_was_called tool=\"grep\""}, 65)
    # line 66: THEN assert_agent_reply contains="main"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "main"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 66, raw: "THEN assert_agent_reply contains=\"main\""}, 66)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-007
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-007] find 文件发现" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-007"}
    # line 69: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 69, raw: "GIVEN create_temp_dir"}, 69)
    # line 70: GIVEN create_temp_file path="a.py" content="# a"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "# a", path: "a.py"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 70, raw: "GIVEN create_temp_file path=\"a.py\" content=\"# a\""}, 70)
    # line 71: GIVEN create_temp_file path="b.py" content="# b"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "# b", path: "b.py"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 71, raw: "GIVEN create_temp_file path=\"b.py\" content=\"# b\""}, 71)
    # line 72: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 72, raw: "GIVEN configure_agent"}, 72)
    # line 73: GIVEN mock_llm_response response_type="tool_call" tool="find_files" tool_args="pattern=*.py|path={{workspace}}"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "find_files", tool_args: "pattern=*.py|path={{workspace}}"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 73, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"find_files\" tool_args=\"pattern=*.py|path={{workspace}}\""}, 73)
    # line 74: GIVEN mock_llm_response response_type="text" content="找到 2 个 Python 文件"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "找到 2 个 Python 文件", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 74, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"找到 2 个 Python 文件\""}, 74)
    # line 75: WHEN agent_chat prompt="找所有 py 文件"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "找所有 py 文件"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 75, raw: "WHEN agent_chat prompt=\"找所有 py 文件\""}, 75)
    # line 76: THEN assert_tool_was_called tool="find_files"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "find_files"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 76, raw: "THEN assert_tool_was_called tool=\"find_files\""}, 76)
    # line 77: THEN assert_agent_reply contains="Python"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "Python"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 77, raw: "THEN assert_agent_reply contains=\"Python\""}, 77)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-008
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-008] ls 目录列表" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-008"}
    # line 80: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 80, raw: "GIVEN create_temp_dir"}, 80)
    # line 81: GIVEN create_temp_file path="file1.txt" content="f1"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "f1", path: "file1.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 81, raw: "GIVEN create_temp_file path=\"file1.txt\" content=\"f1\""}, 81)
    # line 82: GIVEN create_temp_file path="file2.txt" content="f2"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "f2", path: "file2.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 82, raw: "GIVEN create_temp_file path=\"file2.txt\" content=\"f2\""}, 82)
    # line 83: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 83, raw: "GIVEN configure_agent"}, 83)
    # line 84: GIVEN mock_llm_response response_type="tool_call" tool="list_directory" tool_args="path={{workspace}}"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "list_directory", tool_args: "path={{workspace}}"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 84, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"list_directory\" tool_args=\"path={{workspace}}\""}, 84)
    # line 85: GIVEN mock_llm_response response_type="text" content="目录包含 2 个文件"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "目录包含 2 个文件", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 85, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"目录包含 2 个文件\""}, 85)
    # line 86: WHEN agent_chat prompt="列出当前目录"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "列出当前目录"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 86, raw: "WHEN agent_chat prompt=\"列出当前目录\""}, 86)
    # line 87: THEN assert_tool_was_called tool="list_directory"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "list_directory"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 87, raw: "THEN assert_tool_was_called tool=\"list_directory\""}, 87)
    # line 88: THEN assert_agent_reply contains="2"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "2"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 88, raw: "THEN assert_agent_reply contains=\"2\""}, 88)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-009
  @tag :agent
  @tag :e2e
  @tag :integration
  test "[BDD-AGENT-009] E2E 简单问答" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-009"}
    # line 96: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 96, raw: "GIVEN create_temp_dir"}, 96)
    # line 97: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 97, raw: "GIVEN configure_agent"}, 97)
    # line 98: WHEN agent_chat prompt="1+1等于几？请只回答数字"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "1+1等于几？请只回答数字"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 98, raw: "WHEN agent_chat prompt=\"1+1等于几？请只回答数字\""}, 98)
    # line 99: THEN assert_agent_reply contains="2"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "2"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 99, raw: "THEN assert_agent_reply contains=\"2\""}, 99)
    # line 100: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 100, raw: "THEN assert_no_crash"}, 100)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-010
  @tag :agent
  @tag :e2e
  @tag :integration
  test "[BDD-AGENT-010] E2E 文件读取" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-010"}
    # line 103: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 103, raw: "GIVEN create_temp_dir"}, 103)
    # line 104: GIVEN create_temp_file path="test.txt" content="E2E test content"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "E2E test content", path: "test.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 104, raw: "GIVEN create_temp_file path=\"test.txt\" content=\"E2E test content\""}, 104)
    # line 105: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 105, raw: "GIVEN configure_agent"}, 105)
    # line 106: WHEN agent_chat prompt="读一下 test.txt 的内容"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "读一下 test.txt 的内容"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 106, raw: "WHEN agent_chat prompt=\"读一下 test.txt 的内容\""}, 106)
    # line 107: THEN assert_agent_reply contains="E2E test content"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "E2E test content"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 107, raw: "THEN assert_agent_reply contains=\"E2E test content\""}, 107)
    # line 108: THEN assert_tool_was_called tool="read_file"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "read_file"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 108, raw: "THEN assert_tool_was_called tool=\"read_file\""}, 108)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-011
  @tag :agent
  @tag :e2e
  @tag :integration
  test "[BDD-AGENT-011] E2E 文件写入" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-011"}
    # line 111: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 111, raw: "GIVEN create_temp_dir"}, 111)
    # line 112: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 112, raw: "GIVEN configure_agent"}, 112)
    # line 113: WHEN agent_chat prompt="在当前目录创建 hello.txt，内容写 hello from gong"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "在当前目录创建 hello.txt，内容写 hello from gong"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 113, raw: "WHEN agent_chat prompt=\"在当前目录创建 hello.txt，内容写 hello from gong\""}, 113)
    # line 114: THEN assert_file_exists path="hello.txt"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_file_exists, %{path: "hello.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 114, raw: "THEN assert_file_exists path=\"hello.txt\""}, 114)
    # line 115: THEN assert_tool_was_called tool="write_file"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "write_file"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 115, raw: "THEN assert_tool_was_called tool=\"write_file\""}, 115)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-012
  @tag :agent
  @tag :e2e
  @tag :integration
  test "[BDD-AGENT-012] E2E 多轮工具调用" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-012"}
    # line 118: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 118, raw: "GIVEN create_temp_dir"}, 118)
    # line 119: GIVEN create_temp_file path="data.txt" content="original data"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "original data", path: "data.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 119, raw: "GIVEN create_temp_file path=\"data.txt\" content=\"original data\""}, 119)
    # line 120: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 120, raw: "GIVEN configure_agent"}, 120)
    # line 121: WHEN agent_chat prompt="先读 data.txt，然后把 original 改成 modified"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "先读 data.txt，然后把 original 改成 modified"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 121, raw: "WHEN agent_chat prompt=\"先读 data.txt，然后把 original 改成 modified\""}, 121)
    # line 122: THEN assert_tool_was_called tool="read_file"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "read_file"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 122, raw: "THEN assert_tool_was_called tool=\"read_file\""}, 122)
    # line 123: THEN assert_tool_was_called tool="edit_file"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "edit_file"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 123, raw: "THEN assert_tool_was_called tool=\"edit_file\""}, 123)
    # line 124: THEN assert_file_content path="data.txt" expected="modified data"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_file_content, %{expected: "modified data", path: "data.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 124, raw: "THEN assert_file_content path=\"data.txt\" expected=\"modified data\""}, 124)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-013
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-013] 信号路由到正确策略" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-013"}
    # line 131: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 131, raw: "GIVEN create_temp_dir"}, 131)
    # line 132: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 132, raw: "GIVEN configure_agent"}, 132)
    # line 133: GIVEN mock_llm_response response_type="text" content="路由成功"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "路由成功", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 133, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"路由成功\""}, 133)
    # line 134: WHEN agent_chat prompt="测试路由"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "测试路由"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 134, raw: "WHEN agent_chat prompt=\"测试路由\""}, 134)
    # line 135: THEN assert_agent_reply contains="路由成功"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "路由成功"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 135, raw: "THEN assert_agent_reply contains=\"路由成功\""}, 135)
    # line 136: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 136, raw: "THEN assert_no_crash"}, 136)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-014
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-014] 空回复处理" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-014"}
    # line 144: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 144, raw: "GIVEN create_temp_dir"}, 144)
    # line 145: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 145, raw: "GIVEN configure_agent"}, 145)
    # line 146: GIVEN mock_llm_response response_type="text" content=""
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 146, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"\""}, 146)
    # line 147: WHEN agent_chat prompt="说点什么"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "说点什么"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 147, raw: "WHEN agent_chat prompt=\"说点什么\""}, 147)
    # line 148: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 148, raw: "THEN assert_no_crash"}, 148)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-015
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-015] 中文回复" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-015"}
    # line 151: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 151, raw: "GIVEN create_temp_dir"}, 151)
    # line 152: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 152, raw: "GIVEN configure_agent"}, 152)
    # line 153: GIVEN mock_llm_response response_type="text" content="这是一段中文回复"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "这是一段中文回复", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 153, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"这是一段中文回复\""}, 153)
    # line 154: WHEN agent_chat prompt="用中文回复"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "用中文回复"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 154, raw: "WHEN agent_chat prompt=\"用中文回复\""}, 154)
    # line 155: THEN assert_agent_reply contains="中文回复"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "中文回复"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 155, raw: "THEN assert_agent_reply contains=\"中文回复\""}, 155)
    # line 156: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 156, raw: "THEN assert_no_crash"}, 156)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-016
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-016] 长文本回复" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-016"}
    # line 159: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 159, raw: "GIVEN create_temp_dir"}, 159)
    # line 160: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 160, raw: "GIVEN configure_agent"}, 160)
    # line 161: GIVEN mock_llm_response response_type="text" content="这是一段很长的回复内容包含了很多字符用来模拟长文本返回"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "这是一段很长的回复内容包含了很多字符用来模拟长文本返回", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 161, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"这是一段很长的回复内容包含了很多字符用来模拟长文本返回\""}, 161)
    # line 162: WHEN agent_chat prompt="给一个长回复"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "给一个长回复"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 162, raw: "WHEN agent_chat prompt=\"给一个长回复\""}, 162)
    # line 163: THEN assert_agent_reply contains="长文本返回"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "长文本返回"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 163, raw: "THEN assert_agent_reply contains=\"长文本返回\""}, 163)
    # line 164: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 164, raw: "THEN assert_no_crash"}, 164)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-017
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-017] 连续多轮对话" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-017"}
    # line 167: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 167, raw: "GIVEN create_temp_dir"}, 167)
    # line 168: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 168, raw: "GIVEN configure_agent"}, 168)
    # line 169: GIVEN mock_llm_response response_type="text" content="第一轮回复"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "第一轮回复", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 169, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"第一轮回复\""}, 169)
    # line 170: WHEN agent_chat prompt="第一轮"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "第一轮"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 170, raw: "WHEN agent_chat prompt=\"第一轮\""}, 170)
    # line 171: THEN assert_agent_reply contains="第一轮回复"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "第一轮回复"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 171, raw: "THEN assert_agent_reply contains=\"第一轮回复\""}, 171)
    # line 172: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 172, raw: "THEN assert_no_crash"}, 172)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-018
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-018] 工具调用后中文路径" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-018"}
    # line 175: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 175, raw: "GIVEN create_temp_dir"}, 175)
    # line 176: GIVEN create_temp_file path="data/test.txt" content="中文路径测试内容"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "中文路径测试内容", path: "data/test.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 176, raw: "GIVEN create_temp_file path=\"data/test.txt\" content=\"中文路径测试内容\""}, 176)
    # line 177: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 177, raw: "GIVEN configure_agent"}, 177)
    # line 178: GIVEN mock_llm_response response_type="tool_call" tool="read_file" tool_args="file_path={{workspace}}/data/test.txt"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "read_file", tool_args: "file_path={{workspace}}/data/test.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 178, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"read_file\" tool_args=\"file_path={{workspace}}/data/test.txt\""}, 178)
    # line 179: GIVEN mock_llm_response response_type="text" content="读到了中文路径文件内容"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "读到了中文路径文件内容", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 179, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"读到了中文路径文件内容\""}, 179)
    # line 180: WHEN agent_chat prompt="读 data/test.txt"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "读 data/test.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 180, raw: "WHEN agent_chat prompt=\"读 data/test.txt\""}, 180)
    # line 181: THEN assert_agent_reply contains="中文路径"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "中文路径"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 181, raw: "THEN assert_agent_reply contains=\"中文路径\""}, 181)
    # line 182: THEN assert_tool_was_called tool="read_file"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "read_file"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 182, raw: "THEN assert_tool_was_called tool=\"read_file\""}, 182)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-019
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-019] 不存在工具的处理" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-019"}
    # line 185: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 185, raw: "GIVEN create_temp_dir"}, 185)
    # line 186: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 186, raw: "GIVEN configure_agent"}, 186)
    # line 187: GIVEN mock_llm_response response_type="tool_call" tool="nonexistent_tool" tool_args=""
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "nonexistent_tool", tool_args: ""}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 187, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"nonexistent_tool\" tool_args=\"\""}, 187)
    # line 188: GIVEN mock_llm_response response_type="text" content="工具不存在换个方式"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "工具不存在换个方式", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 188, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"工具不存在换个方式\""}, 188)
    # line 189: WHEN agent_chat prompt="做些什么"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "做些什么"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 189, raw: "WHEN agent_chat prompt=\"做些什么\""}, 189)
    # line 190: THEN assert_agent_reply contains="换个方式"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "换个方式"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 190, raw: "THEN assert_agent_reply contains=\"换个方式\""}, 190)
    # line 191: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 191, raw: "THEN assert_no_crash"}, 191)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-020
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-020] bash 工具调用" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-020"}
    # line 194: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 194, raw: "GIVEN create_temp_dir"}, 194)
    # line 195: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 195, raw: "GIVEN configure_agent"}, 195)
    # line 196: GIVEN mock_llm_response response_type="tool_call" tool="bash" tool_args="command=echo ok"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "bash", tool_args: "command=echo ok"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 196, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"bash\" tool_args=\"command=echo ok\""}, 196)
    # line 197: GIVEN mock_llm_response response_type="text" content="命令执行成功"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "命令执行成功", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 197, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"命令执行成功\""}, 197)
    # line 198: WHEN agent_chat prompt="执行 echo ok"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "执行 echo ok"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 198, raw: "WHEN agent_chat prompt=\"执行 echo ok\""}, 198)
    # line 199: THEN assert_tool_was_called tool="bash"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_was_called, %{tool: "bash"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 199, raw: "THEN assert_tool_was_called tool=\"bash\""}, 199)
    # line 200: THEN assert_agent_reply contains="执行成功"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "执行成功"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 200, raw: "THEN assert_agent_reply contains=\"执行成功\""}, 200)
    # line 201: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 201, raw: "THEN assert_no_crash"}, 201)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-021
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-021] LLM 返回错误后恢复" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-021"}
    # line 208: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 208, raw: "GIVEN create_temp_dir"}, 208)
    # line 209: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 209, raw: "GIVEN configure_agent"}, 209)
    # line 210: GIVEN mock_llm_response response_type="error" content="API rate limit exceeded"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "API rate limit exceeded", response_type: "error"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 210, raw: "GIVEN mock_llm_response response_type=\"error\" content=\"API rate limit exceeded\""}, 210)
    # line 211: WHEN agent_chat prompt="你好"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "你好"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 211, raw: "WHEN agent_chat prompt=\"你好\""}, 211)
    # line 212: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 212, raw: "THEN assert_no_crash"}, 212)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-022
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-022] 工具执行失败后继续" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-022"}
    # line 215: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 215, raw: "GIVEN create_temp_dir"}, 215)
    # line 216: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 216, raw: "GIVEN configure_agent"}, 216)
    # line 217: GIVEN mock_llm_response response_type="tool_call" tool="read_file" tool_args="file_path=/nonexistent/file.txt"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "read_file", tool_args: "file_path=/nonexistent/file.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 217, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"read_file\" tool_args=\"file_path=/nonexistent/file.txt\""}, 217)
    # line 218: GIVEN mock_llm_response response_type="text" content="文件不存在让我换个方式"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "文件不存在让我换个方式", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 218, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"文件不存在让我换个方式\""}, 218)
    # line 219: WHEN agent_chat prompt="读一个不存在的文件"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "读一个不存在的文件"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 219, raw: "WHEN agent_chat prompt=\"读一个不存在的文件\""}, 219)
    # line 220: THEN assert_agent_reply contains="不存在"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "不存在"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 220, raw: "THEN assert_agent_reply contains=\"不存在\""}, 220)
    # line 221: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 221, raw: "THEN assert_no_crash"}, 221)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-023
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-023] bash 命令超时后继续" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-023"}
    # line 224: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 224, raw: "GIVEN create_temp_dir"}, 224)
    # line 225: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 225, raw: "GIVEN configure_agent"}, 225)
    # line 226: GIVEN mock_llm_response response_type="tool_call" tool="bash" tool_args="command=sleep 100|timeout=1"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "bash", tool_args: "command=sleep 100|timeout=1"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 226, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"bash\" tool_args=\"command=sleep 100|timeout=1\""}, 226)
    # line 227: GIVEN mock_llm_response response_type="text" content="命令超时了"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "命令超时了", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 227, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"命令超时了\""}, 227)
    # line 228: WHEN agent_chat prompt="执行一个会超时的命令"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "执行一个会超时的命令"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 228, raw: "WHEN agent_chat prompt=\"执行一个会超时的命令\""}, 228)
    # line 229: THEN assert_agent_reply contains="超时"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "超时"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 229, raw: "THEN assert_agent_reply contains=\"超时\""}, 229)
    # line 230: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 230, raw: "THEN assert_no_crash"}, 230)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-024
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-024] 权限拒绝后继续" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-024"}
    # line 233: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 233, raw: "GIVEN create_temp_dir"}, 233)
    # line 234: GIVEN create_temp_file path="readonly.txt" content="protected"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_file, %{content: "protected", path: "readonly.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 234, raw: "GIVEN create_temp_file path=\"readonly.txt\" content=\"protected\""}, 234)
    # line 235: GIVEN set_file_permission path="readonly.txt" mode="444"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :set_file_permission, %{mode: "444", path: "readonly.txt"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 235, raw: "GIVEN set_file_permission path=\"readonly.txt\" mode=\"444\""}, 235)
    # line 236: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 236, raw: "GIVEN configure_agent"}, 236)
    # line 237: GIVEN mock_llm_response response_type="tool_call" tool="write_file" tool_args="file_path={{workspace}}/readonly.txt|content=overwrite"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "write_file", tool_args: "file_path={{workspace}}/readonly.txt|content=overwrite"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 237, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"write_file\" tool_args=\"file_path={{workspace}}/readonly.txt|content=overwrite\""}, 237)
    # line 238: GIVEN mock_llm_response response_type="text" content="写入被拒绝了"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "写入被拒绝了", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 238, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"写入被拒绝了\""}, 238)
    # line 239: WHEN agent_chat prompt="覆写只读文件"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "覆写只读文件"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 239, raw: "WHEN agent_chat prompt=\"覆写只读文件\""}, 239)
    # line 240: THEN assert_agent_reply contains="拒绝"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "拒绝"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 240, raw: "THEN assert_agent_reply contains=\"拒绝\""}, 240)
    # line 241: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 241, raw: "THEN assert_no_crash"}, 241)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-025
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-025] 连续错误不崩溃" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-025"}
    # line 244: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 244, raw: "GIVEN create_temp_dir"}, 244)
    # line 245: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 245, raw: "GIVEN configure_agent"}, 245)
    # line 246: GIVEN mock_llm_response response_type="tool_call" tool="read_file" tool_args="file_path=/no/such/file1"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "read_file", tool_args: "file_path=/no/such/file1"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 246, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"read_file\" tool_args=\"file_path=/no/such/file1\""}, 246)
    # line 247: GIVEN mock_llm_response response_type="tool_call" tool="read_file" tool_args="file_path=/no/such/file2"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{response_type: "tool_call", tool: "read_file", tool_args: "file_path=/no/such/file2"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 247, raw: "GIVEN mock_llm_response response_type=\"tool_call\" tool=\"read_file\" tool_args=\"file_path=/no/such/file2\""}, 247)
    # line 248: GIVEN mock_llm_response response_type="text" content="两次都失败了"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "两次都失败了", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 248, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"两次都失败了\""}, 248)
    # line 249: WHEN agent_chat prompt="读两个不存在的文件"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "读两个不存在的文件"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 249, raw: "WHEN agent_chat prompt=\"读两个不存在的文件\""}, 249)
    # line 250: THEN assert_agent_reply contains="失败"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "失败"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 250, raw: "THEN assert_agent_reply contains=\"失败\""}, 250)
    # line 251: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 251, raw: "THEN assert_no_crash"}, 251)
    _ctx = ctx
    :ok
  end

  # Source: BDD-AGENT-026
  @tag :agent
  @tag :integration
  test "[BDD-AGENT-026] Agent 进程存活性" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "BDD-AGENT-026"}
    # line 254: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 254, raw: "GIVEN create_temp_dir"}, 254)
    # line 255: GIVEN configure_agent
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :configure_agent, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 255, raw: "GIVEN configure_agent"}, 255)
    # line 256: GIVEN mock_llm_response response_type="text" content="第一次成功"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :mock_llm_response, %{content: "第一次成功", response_type: "text"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 256, raw: "GIVEN mock_llm_response response_type=\"text\" content=\"第一次成功\""}, 256)
    # line 257: WHEN agent_chat prompt="第一次对话"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :agent_chat, %{prompt: "第一次对话"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 257, raw: "WHEN agent_chat prompt=\"第一次对话\""}, 257)
    # line 258: THEN assert_agent_reply contains="第一次成功"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_agent_reply, %{contains: "第一次成功"}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 258, raw: "THEN assert_agent_reply contains=\"第一次成功\""}, 258)
    # line 259: THEN assert_no_crash
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_no_crash, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/agent_integration.dsl", line: 259, raw: "THEN assert_no_crash"}, 259)
    _ctx = ctx
    :ok
  end

end
