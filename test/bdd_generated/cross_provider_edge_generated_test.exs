# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.CrossProviderEdgeTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: CROSS-ERR-001
  @tag :cross_provider
  @tag :unit
  test "[CROSS-ERR-001] thinking 内容跨厂商转换为纯文本" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "CROSS-ERR-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: GIVEN cross_provider_messages_with_thinking count=2
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :cross_provider_messages_with_thinking, %{count: 2}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 10, raw: "GIVEN cross_provider_messages_with_thinking count=2"}, 10)
    # line 11: WHEN convert_messages from="anthropic" to="openai"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :convert_messages, %{from: "anthropic", to: "openai"}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 11, raw: "WHEN convert_messages from=\"anthropic\" to=\"openai\""}, 11)
    # line 12: THEN assert_converted_messages count=2
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_converted_messages, %{count: 2}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 12, raw: "THEN assert_converted_messages count=2"}, 12)
    # line 13: THEN assert_content_is_text
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_content_is_text, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 13, raw: "THEN assert_content_is_text"}, 13)
    _ctx = ctx
    :ok
  end

  # Source: CROSS-ERR-002
  @tag :cross_provider
  @tag :unit
  test "[CROSS-ERR-002] 同厂商不同模型切换不丢消息" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "CROSS-ERR-002"}
    # line 16: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 16, raw: "GIVEN create_temp_dir"}, 16)
    # line 17: GIVEN cross_provider_messages count=5
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :cross_provider_messages, %{count: 5}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 17, raw: "GIVEN cross_provider_messages count=5"}, 17)
    # line 18: WHEN convert_messages from="openai" to="openai"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :convert_messages, %{from: "openai", to: "openai"}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 18, raw: "WHEN convert_messages from=\"openai\" to=\"openai\""}, 18)
    # line 19: THEN assert_converted_messages count=5
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_converted_messages, %{count: 5}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 19, raw: "THEN assert_converted_messages count=5"}, 19)
    _ctx = ctx
    :ok
  end

  # Source: CROSS-ERR-003
  @tag :cross_provider
  @tag :unit
  test "[CROSS-ERR-003] 带错误状态 assistant 消息在转换时被过滤" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "CROSS-ERR-003"}
    # line 22: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 22, raw: "GIVEN create_temp_dir"}, 22)
    # line 23: GIVEN cross_provider_messages_with_error count=3
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :cross_provider_messages_with_error, %{count: 3}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 23, raw: "GIVEN cross_provider_messages_with_error count=3"}, 23)
    # line 24: WHEN convert_messages from="anthropic" to="deepseek"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :convert_messages, %{from: "anthropic", to: "deepseek"}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 24, raw: "WHEN convert_messages from=\"anthropic\" to=\"deepseek\""}, 24)
    # line 25: THEN assert_error_messages_filtered
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_error_messages_filtered, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 25, raw: "THEN assert_error_messages_filtered"}, 25)
    _ctx = ctx
    :ok
  end

  # Source: CROSS-ERR-004
  @tag :cross_provider
  @tag :unit
  test "[CROSS-ERR-004] 事件/状态一致性" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "CROSS-ERR-004"}
    # line 32: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 32, raw: "GIVEN create_temp_dir"}, 32)
    # line 33: GIVEN register_state_observer_hook
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :register_state_observer_hook, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 33, raw: "GIVEN register_state_observer_hook"}, 33)
    # line 34: WHEN emit_event_with_message content="new test message"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :emit_event_with_message, %{content: "new test message"}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 34, raw: "WHEN emit_event_with_message content=\"new test message\""}, 34)
    # line 35: THEN assert_observer_saw_updated_state
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_observer_saw_updated_state, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 35, raw: "THEN assert_observer_saw_updated_state"}, 35)
    _ctx = ctx
    :ok
  end

  # Source: CROSS-ERR-005
  @tag :stream
  @tag :unit
  test "[CROSS-ERR-005] 流式期间 tool result 被缓冲不与 streaming 交错" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "CROSS-ERR-005"}
    # line 38: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 38, raw: "GIVEN create_temp_dir"}, 38)
    # line 39: GIVEN cross_provider_tool_calls_message
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :cross_provider_tool_calls_message, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 39, raw: "GIVEN cross_provider_tool_calls_message"}, 39)
    # line 40: WHEN buffer_tool_result_during_stream
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :buffer_tool_result_during_stream, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 40, raw: "WHEN buffer_tool_result_during_stream"}, 40)
    # line 41: THEN assert_tool_result_buffered
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_tool_result_buffered, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/cross_provider_edge.dsl", line: 41, raw: "THEN assert_tool_result_buffered"}, 41)
    _ctx = ctx
    :ok
  end

end
