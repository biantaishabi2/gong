# Generated by bdd_compiler from /home/wangbo/document/gong/docs/bdd/auth_edge.dsl. DO NOT EDIT.

defmodule Gong.BDD.Generated.AuthEdgeTest do
  use ExUnit.Case, async: false

  @moduletag :bdd_generated

  # Source: AUTH-ERR-001
  @tag :auth
  @tag :unit
  test "[AUTH-ERR-001] 认证锁文件损坏时优雅恢复" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-ERR-001"}
    # line 9: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 9, raw: "GIVEN create_temp_dir"}, 9)
    # line 10: GIVEN create_auth_lock_file content="{\"token\": \"valid\"}"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_auth_lock_file, %{content: "{\\\"token\\\": \\\"valid\\\"}"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 10, raw: "GIVEN create_auth_lock_file content=\"{\\\"token\\\": \\\"valid\\\"}\""}, 10)
    # line 11: GIVEN corrupt_auth_lock_file
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :corrupt_auth_lock_file, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 11, raw: "GIVEN corrupt_auth_lock_file"}, 11)
    # line 12: THEN assert_auth_lock_recovered
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_auth_lock_recovered, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 12, raw: "THEN assert_auth_lock_recovered"}, 12)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-ERR-002
  @tag :auth
  @tag :unit
  test "[AUTH-ERR-002] API key 环境变量不被全局修改" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-ERR-002"}
    # line 15: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 15, raw: "GIVEN create_temp_dir"}, 15)
    # line 16: GIVEN set_env_api_key env_var="TEST_API_KEY" value="sk-test-12345"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :set_env_api_key, %{env_var: "TEST_API_KEY", value: "sk-test-12345"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 16, raw: "GIVEN set_env_api_key env_var=\"TEST_API_KEY\" value=\"sk-test-12345\""}, 16)
    # line 17: WHEN get_api_key_via_auth env_var="TEST_API_KEY"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :get_api_key_via_auth, %{env_var: "TEST_API_KEY"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 17, raw: "WHEN get_api_key_via_auth env_var=\"TEST_API_KEY\""}, 17)
    # line 18: THEN assert_env_unchanged env_var="TEST_API_KEY" expected="sk-test-12345"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_env_unchanged, %{env_var: "TEST_API_KEY", expected: "sk-test-12345"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 18, raw: "THEN assert_env_unchanged env_var=\"TEST_API_KEY\" expected=\"sk-test-12345\""}, 18)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-ERR-003
  @tag :auth
  @tag :unit
  test "[AUTH-ERR-003] 登出后清理模型引用" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-ERR-003"}
    # line 25: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 25, raw: "GIVEN create_temp_dir"}, 25)
    # line 26: GIVEN init_model_registry
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :init_model_registry, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 26, raw: "GIVEN init_model_registry"}, 26)
    # line 27: GIVEN register_model name="auth_model" provider="anthropic" model_id="claude-3"
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :register_model, %{model_id: "claude-3", name: "auth_model", provider: "anthropic"}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 27, raw: "GIVEN register_model name=\"auth_model\" provider=\"anthropic\" model_id=\"claude-3\""}, 27)
    # line 28: WHEN auth_logout
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :auth_logout, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 28, raw: "WHEN auth_logout"}, 28)
    # line 29: THEN assert_model_references_cleaned
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_model_references_cleaned, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 29, raw: "THEN assert_model_references_cleaned"}, 29)
    _ctx = ctx
    :ok
  end

  # Source: AUTH-ERR-004
  @tag :auth
  @tag :unit
  test "[AUTH-ERR-004] 长时间运行时 OAuth token 自动刷新" do
    run_id = Gong.BDD.Instructions.V1.new_run_id()
    ctx = %{run_id: run_id, scenario_id: "AUTH-ERR-004"}
    # line 32: GIVEN create_temp_dir
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_temp_dir, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 32, raw: "GIVEN create_temp_dir"}, 32)
    # line 33: GIVEN create_expiring_token expires_in_seconds=5
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :given, :create_expiring_token, %{expires_in_seconds: 5}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 33, raw: "GIVEN create_expiring_token expires_in_seconds=5"}, 33)
    # line 34: WHEN simulate_token_check
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :when, :simulate_token_check, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 34, raw: "WHEN simulate_token_check"}, 34)
    # line 35: THEN assert_token_refreshed
    ctx = Gong.BDD.Instructions.V1.run_step!(ctx, :then, :assert_token_refreshed, %{}, %{file: "/home/wangbo/document/gong/docs/bdd/auth_edge.dsl", line: 35, raw: "THEN assert_token_refreshed"}, 35)
    _ctx = ctx
    :ok
  end

end
